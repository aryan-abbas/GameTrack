<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f1220;
      --panel: #171a2a;
      --muted: #8b90a8;
      --text: #e6e8f3;
      --accent: #6a9efc;
      --danger: #ff5468;
      --success: #59d398;
      --border: #262a3f;
      --warning: #ffa726;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; background: var(--bg); color: var(--text); 
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    header {
      padding: 16px 20px; border-bottom: 1px solid var(--border); background: var(--panel);
      display: flex; align-items: center; justify-content: space-between;
    }
    header h1 { margin: 0; font-size: 20px; color: #fff; }
    .container { display: grid; grid-template-columns: 260px 1fr; gap: 16px; padding: 16px; }
    .card {
      background: var(--panel); border: 1px solid var(--border); border-radius: 10px; overflow: hidden;
    }
    .card h2 { 
      font-size: 18px; margin: 0; padding: 16px 18px; 
      border-bottom: 1px solid var(--border); 
      color: #fff; font-weight: 600;
    }
    .card .content { padding: 18px; }

    .tabs {
      display: flex; gap: 8px; padding: 16px 18px; border-bottom: 1px solid var(--border);
    }
    .tab {
      padding: 8px 16px; border-radius: 8px; cursor: pointer; 
      background: transparent; border: 1px solid var(--border);
      color: var(--muted); font-weight: 500; transition: all 0.2s;
    }
    .tab.active {
      background: var(--accent); color: #0b1020; border-color: var(--accent);
    }

    .filters label { 
      display: flex; align-items: center; gap: 8px; margin-bottom: 10px; 
      cursor: pointer; color: #fff;
    }
    .filters input[type="radio"] { accent-color: var(--accent); }

    form { display: flex; flex-direction: column; gap: 16px; }
    .form-group { display: flex; flex-direction: column; gap: 6px; }
    .form-label { 
      color: #fff; font-size: 14px; font-weight: 500; 
      display: flex; align-items: center; gap: 6px;
    }
    .step-number {
      display: inline-flex; align-items: center; justify-content: center;
      width: 24px; height: 24px; border-radius: 50%;
      background: var(--accent); color: #0b1020; font-weight: 600;
      font-size: 12px;
    }
    input, select, button, textarea {
      padding: 12px 14px; border: 1px solid var(--border); 
      border-radius: 8px; background: #121528; color: #fff;
      font-size: 14px;
    }
    input::placeholder, textarea::placeholder { color: #70779c; }
    button { 
      cursor: pointer; background: var(--accent); border: none; 
      color: #0b1020; font-weight: 600; 
    }
    button.secondary { background: #1d2240; color: #fff; border: 1px solid var(--border); }
    button.danger { background: var(--danger); color: #fff; }
    button.wishlist { background: var(--warning); color: #0b1020; }

    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 12px; }
    .game {
      background: #121528; border: 1px solid var(--border); border-radius: 10px; overflow: hidden;
      display: grid; grid-template-rows: 140px auto; min-height: 320px;
    }
    .game.wishlist-item {
      border: 2px solid var(--warning);
    }
    .game .cover { background: #0b0e1c; display: flex; align-items: center; justify-content: center; }
    .game img { max-width: 100%; max-height: 100%; object-fit: cover; }
    .game .meta { padding: 12px; display: grid; gap: 6px; }
    .badge { 
      display: inline-block; padding: 4px 8px; border-radius: 999px; 
      font-size: 12px; background: #1d2240; border: 1px solid var(--border); 
      color: var(--muted); 
    }
    .badge.wishlist { background: var(--warning); color: #0b1020; border-color: var(--warning); }
    .muted { color: var(--muted); font-size: 12px; }
    .actions { display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap; }
    .storage-row { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; }
    .status { 
      display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; 
      background: var(--success); color: #0b1020; font-weight: 600;
    }
    .status.error { background: var(--danger); color: #fff; }

    .note { color: var(--muted); font-size: 12px; margin-top: 8px; }
    .divider { height: 1px; background: var(--border); margin: 16px 0; }
    
    textarea { resize: vertical; min-height: 80px; font-family: inherit; }
    
    @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <header>
    <h1>Game Tracker <span id="dbStatus" class="status">Connecting...</span></h1>
    <div>
      <button id="exportBtn" class="secondary">Export</button>
      <button id="importBtn" class="secondary">Import</button>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h2>Filters</h2>
      <div class="content filters">
        <label><input type="radio" name="deviceFilter" value="ALL" checked /> All devices</label>
        <label><input type="radio" name="deviceFilter" value="PC" /> PC</label>
        <label><input type="radio" name="deviceFilter" value="Nintendo Switch" /> Nintendo Switch</label>
        <label><input type="radio" name="deviceFilter" value="PlayStation" /> PlayStation</label>
        <hr style="border-color: var(--border);" />
        <label class="storage">
          <input type="text" id="searchInput" placeholder="Search title‚Ä¶" />
        </label>
      </div>
    </section>

    <section class="card">
      <div class="tabs">
        <button class="tab active" data-tab="library">My Library</button>
        <button class="tab" data-tab="wishlist">Wishlist</button>
      </div>
      
      <div class="content">
        <!-- LIBRARY TAB -->
        <div id="libraryTab">
          <form id="addForm" autocomplete="off">
            <div class="form-group">
              <label class="form-label" for="device">
                <span class="step-number">1</span>
                What device is your game on?
              </label>
              <select id="device" required>
                <option value="">Choose device</option>
                <option>PC</option>
                <option>Nintendo Switch</option>
                <option>PlayStation</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="titleInput">
                <span class="step-number">2</span>
                What's the game title?
              </label>
              <input id="titleInput" type="text" placeholder="e.g., Elden Ring" required />
            </div>

            <div class="form-group">
              <label class="form-label" for="storageInput">
                <span class="step-number">3</span>
                Where is the game stored?
              </label>
              <input id="storageInput" type="text" placeholder="e.g., D:\Games\Elden Ring" required />
            </div>

            <div class="form-group">
              <label class="form-label" for="releaseInput">
                <span class="step-number">4</span>
                When was it released? (optional)
              </label>
              <input id="releaseInput" type="date" />
            </div>

            <div class="form-group">
              <label class="form-label" for="coverInput">
                <span class="step-number">5</span>
                Cover art URL (optional)
              </label>
              <input id="coverInput" type="url" placeholder="https://example.com/cover.jpg" />
            </div>

            <button type="button" id="fetchMetaBtn" class="secondary">Auto-fill with metadata</button>
            <button type="submit">Add to Library</button>
            
            <p class="note">üí° Tip: Click "Auto-fill with metadata" to fetch game details automatically. After adding, click "Get Review" to fetch ratings from IGDB.</p>
          </form>

          <div class="divider"></div>
          <h2 style="margin: 16px 0 12px 0; font-size: 18px; color: #fff;">üìö Game Library</h2>
          <div id="libraryGrid" class="grid" aria-live="polite"></div>
        </div>

        <!-- WISHLIST TAB -->
        <div id="wishlistTab" style="display: none;">
          <form id="wishlistForm" autocomplete="off">
            <div class="form-group">
              <label class="form-label" for="wishDevice">
                <span class="step-number">1</span>
                What device will you play on?
              </label>
              <select id="wishDevice" required>
                <option value="">Choose device</option>
                <option>PC</option>
                <option>Nintendo Switch</option>
                <option>PlayStation</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="wishTitle">
                <span class="step-number">2</span>
                What game do you want?
              </label>
              <input id="wishTitle" type="text" placeholder="e.g., Hollow Knight" required />
            </div>

            <div class="form-group">
              <label class="form-label" for="wishRelease">
                <span class="step-number">3</span>
                Expected release date (optional)
              </label>
              <input id="wishRelease" type="date" />
            </div>

            <div class="form-group">
              <label class="form-label" for="wishNotes">
                <span class="step-number">4</span>
                Why do you want this game? (optional)
              </label>
              <textarea id="wishNotes" placeholder="Add notes about why you want this game..."></textarea>
            </div>

            <div class="form-group">
              <label class="form-label" for="wishCover">
                <span class="step-number">5</span>
                Cover art URL (optional)
              </label>
              <input id="wishCover" type="url" placeholder="https://example.com/cover.jpg" />
            </div>

            <button type="button" id="fetchWishMetaBtn" class="secondary">Auto-fill with metadata</button>
            <button type="submit" class="wishlist">Add to Wishlist</button>
            
            <p class="note">‚≠ê Build your wishlist of games you want to play!</p>
          </form>

          <div class="divider"></div>
          <h2 style="margin: 16px 0 12px 0; font-size: 18px; color: #fff;">‚≠ê My Wishlist</h2>
          <div id="wishlistGrid" class="grid" aria-live="polite"></div>
        </div>
      </div>
    </section>
  </main>

  <script>
    const API_URL = '/api/games';
    const RAWG_API_KEY = "eec0b7eb3fc341ffb9dbad7f8e0e2822";
    const IGDB_CLIENT_ID = "7vfa5tb2hk6alk1ah7rb25s1ef4uuw";
    const IGDB_ACCESS_TOKEN = "ji3ood2sdh3s9lpeu5os9douglb8k2";

    let state = [];
    let wishlist = [];
    let isConnected = false;
    let currentTab = 'library';

    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    // Tab switching
    $$('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.dataset.tab;
        currentTab = tabName;
        
        $$('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        $('#libraryTab').style.display = tabName === 'library' ? 'block' : 'none';
        $('#wishlistTab').style.display = tabName === 'wishlist' ? 'block' : 'none';
      });
    });

    async function loadGames() {
      try {
        const response = await fetch(API_URL);
        if (!response.ok) throw new Error('Failed to load games');
        const allGames = await response.json();
        
        state = allGames.filter(g => !g.isWishlist);
        wishlist = allGames.filter(g => g.isWishlist);
        
        updateConnectionStatus(true);
        return allGames;
      } catch (error) {
        console.error('Load error:', error);
        updateConnectionStatus(false);
        return [];
      }
    }

    async function addGame(game) {
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(game)
        });
        if (!response.ok) throw new Error('Failed to add game');
        const newGame = await response.json();
        
        if (game.isWishlist) {
          wishlist.unshift(newGame);
        } else {
          state.unshift(newGame);
        }
        return newGame;
      } catch (error) {
        console.error('Add error:', error);
        throw error;
      }
    }

    async function updateGame(id, updates) {
      try {
        const response = await fetch(`${API_URL}?id=${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(updates)
        });
        if (!response.ok) throw new Error('Failed to update game');
        
        const game = state.find(g => g._id === id) || wishlist.find(g => g._id === id);
        if (game) Object.assign(game, updates);
      } catch (error) {
        console.error('Update error:', error);
        throw error;
      }
    }

    async function deleteGame(id, fromWishlist = false) {
      try {
        const response = await fetch(`${API_URL}?id=${id}`, {
          method: 'DELETE'
        });
        if (!response.ok) throw new Error('Failed to delete game');
        
        if (fromWishlist) {
          wishlist = wishlist.filter(g => g._id !== id);
        } else {
          state = state.filter(g => g._id !== id);
        }
      } catch (error) {
        console.error('Delete error:', error);
        throw error;
      }
    }

    async function moveToLibrary(id) {
      const game = wishlist.find(g => g._id === id);
      if (!game) return;
      
      try {
        await updateGame(id, { isWishlist: false });
        wishlist = wishlist.filter(g => g._id !== id);
        state.unshift(game);
        game.isWishlist = false;
        render();
      } catch (error) {
        alert('Failed to move to library');
      }
    }

    function updateConnectionStatus(connected) {
      isConnected = connected;
      const status = $('#dbStatus');
      if (connected) {
        status.textContent = 'üü¢ MongoDB Connected';
        status.className = 'status';
      } else {
        status.textContent = 'üî¥ MongoDB Error';
        status.className = 'status error';
      }
    }

    async function fetchMetadata(query) {
      const url = `https://api.rawg.io/api/games?search=${encodeURIComponent(query)}&key=${RAWG_API_KEY}&page_size=1`;
      const resp = await fetch(url);
      const data = await resp.json();
      const game = data.results?.[0];
      return {
        title: game?.name || query,
        releaseDate: game?.released || "",
        imageUrl: game?.background_image || ""
      };
    }

    async function fetchIGDBReviews(gameName) {
      try {
        const searchResponse = await fetch('https://api.igdb.com/v4/games', {
          method: 'POST',
          headers: {
            'Client-ID': IGDB_CLIENT_ID,
            'Authorization': `Bearer ${IGDB_ACCESS_TOKEN}`,
            'Content-Type': 'text/plain'
          },
          body: `search "${gameName}"; fields name,rating,rating_count,aggregated_rating,aggregated_rating_count,summary; limit 1;`
        });

        if (!searchResponse.ok) throw new Error('IGDB search failed');
        const games = await searchResponse.json();
        
        if (!games || games.length === 0) {
          return { rating: null, summary: 'No review data available' };
        }

        const game = games[0];
        return {
          rating: game.rating ? Math.round(game.rating) : game.aggregated_rating ? Math.round(game.aggregated_rating) : null,
          ratingCount: game.rating_count || game.aggregated_rating_count || 0,
          summary: game.summary || 'No summary available'
        };
      } catch (error) {
        console.error('IGDB API error:', error);
        return { rating: null, summary: 'Failed to load review data' };
      }
    }

    const libraryGrid = $("#libraryGrid");
    const wishlistGrid = $("#wishlistGrid");
    const filterRadios = $$("input[name='deviceFilter']");
    const searchInput = $("#searchInput");

    function render() {
      renderLibrary();
      renderWishlist();
    }

    function renderLibrary() {
      const deviceFilter = filterRadios.find(r => r.checked)?.value || "ALL";
      const term = searchInput.value.trim().toLowerCase();
      libraryGrid.innerHTML = "";

      if (!isConnected) {
        libraryGrid.innerHTML = `<div class="muted">‚ö†Ô∏è Cannot connect to MongoDB. Make sure the server is running.</div>`;
        return;
      }

      const filtered = state.filter(g => {
        const matchDevice = deviceFilter === "ALL" || g.device === deviceFilter;
        const matchTerm = !term || g.title.toLowerCase().includes(term);
        return matchDevice && matchTerm;
      });

      if (filtered.length === 0) {
        libraryGrid.innerHTML = `<div class="muted">No games found. Try adding one above.</div>`;
        return;
      }

      for (const g of filtered) {
        const card = document.createElement("div");
        card.className = "game";
        
        const ratingDisplay = g.review?.rating 
          ? `<div style="display: flex; align-items: center; gap: 4px; margin-top: 4px;">
               <span style="color: var(--success); font-weight: 600;">${g.review.rating}/100</span>
               <span class="muted">(${g.review.ratingCount} reviews)</span>
             </div>`
          : '';
        
        const summaryDisplay = g.review?.summary 
          ? `<div class="muted" style="font-size: 11px; margin-top: 6px; line-height: 1.4; max-height: 60px; overflow: hidden;">${escapeHtml(g.review.summary.substring(0, 150))}${g.review.summary.length > 150 ? '...' : ''}</div>`
          : '';
        
        card.innerHTML = `
          <div class="cover">${g.imageUrl ? `<img src="${g.imageUrl}" alt="${escapeHtml(g.title)} cover" />` : `<span class="muted">No cover</span>`}</div>
          <div class="meta">
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <strong style="color: #fff;">${escapeHtml(g.title)}</strong>
              <span class="badge">${g.device}</span>
            </div>
            <div class="muted">Release: ${g.releaseDate || "Unknown"}</div>
            ${ratingDisplay}
            ${summaryDisplay}
            <div class="storage-row">
              <input type="text" value="${escapeAttr(g.storagePath)}" data-id="${g._id}" class="storage-edit" />
              <button class="secondary" data-id="${g._id}" data-action="save-storage">Save</button>
            </div>
            <div class="actions">
              ${!g.review ? `<button class="secondary" data-id="${g._id}" data-action="fetch-review">Get Review</button>` : ''}
              <button class="danger" data-id="${g._id}" data-action="delete">Delete</button>
            </div>
          </div>
        `;
        libraryGrid.appendChild(card);
      }
    }

    function renderWishlist() {
      wishlistGrid.innerHTML = "";

      if (!isConnected) {
        wishlistGrid.innerHTML = `<div class="muted">‚ö†Ô∏è Cannot connect to MongoDB.</div>`;
        return;
      }

      if (wishlist.length === 0) {
        wishlistGrid.innerHTML = `<div class="muted">No games in your wishlist yet. Add some above!</div>`;
        return;
      }

      for (const g of wishlist) {
        const card = document.createElement("div");
        card.className = "game wishlist-item";
        
        card.innerHTML = `
          <div class="cover">${g.imageUrl ? `<img src="${g.imageUrl}" alt="${escapeHtml(g.title)} cover" />` : `<span class="muted">No cover</span>`}</div>
          <div class="meta">
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <strong style="color: #fff;">${escapeHtml(g.title)}</strong>
              <span class="badge wishlist">‚≠ê Wishlist</span>
            </div>
            <div class="muted">Device: ${g.device}</div>
            <div class="muted">Release: ${g.releaseDate || "TBA"}</div>
            ${g.notes ? `<div class="muted" style="margin-top: 8px; font-style: italic;">"${escapeHtml(g.notes)}"</div>` : ''}
            <div class="actions">
              <button class="secondary" data-id="${g._id}" data-action="move-to-library">Move to Library</button>
              <button class="danger" data-id="${g._id}" data-action="delete-wish">Delete</button>
            </div>
          </div>
        `;
        wishlistGrid.appendChild(card);
      }
    }

    function escapeHtml(s = "") {
      return s.replace(/[&<>"']/g, c => ({ "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;", "'":"&#39;" }[c]));
    }
    function escapeAttr(s = "") {
      return s.replace(/"/g, "&quot;");
    }

    // Library form
    const addForm = $("#addForm");
    const fetchMetaBtn = $("#fetchMetaBtn");

    fetchMetaBtn.addEventListener("click", async () => {
      const q = $("#titleInput").value.trim();
      if (!q) { alert("Enter a game title first."); return; }
      fetchMetaBtn.disabled = true; fetchMetaBtn.textContent = "Fetching‚Ä¶";
      try {
        const meta = await fetchMetadata(q);
        if (!$("#releaseInput").value) $("#releaseInput").value = meta.releaseDate;
        if (!$("#coverInput").value) $("#coverInput").value = meta.imageUrl;
      } catch (e) {
        alert("Failed to fetch metadata. Try again.");
      } finally {
        fetchMetaBtn.disabled = false; fetchMetaBtn.textContent = "Auto-fill with metadata";
      }
    });

    addForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const device = $("#device").value.trim();
      const title = $("#titleInput").value.trim();
      const storagePath = $("#storageInput").value.trim();
      
      if (!device || !title || !storagePath) {
        alert("Please fill device, title, and storage directory.");
        return;
      }
      
      try {
        await addGame({
          device,
          title,
          storagePath,
          releaseDate: $("#releaseInput").value || "",
          imageUrl: $("#coverInput").value || "",
          isWishlist: false
        });
        render();
        addForm.reset();
      } catch (error) {
        alert("Failed to add game. Check server connection.");
      }
    });

    // Wishlist form
    const wishlistForm = $("#wishlistForm");
    const fetchWishMetaBtn = $("#fetchWishMetaBtn");

    fetchWishMetaBtn.addEventListener("click", async () => {
      const q = $("#wishTitle").value.trim();
      if (!q) { alert("Enter a game title first."); return; }
      fetchWishMetaBtn.disabled = true; fetchWishMetaBtn.textContent = "Fetching‚Ä¶";
      try {
        const meta = await fetchMetadata(q);
        if (!$("#wishRelease").value) $("#wishRelease").value = meta.releaseDate;
        if (!$("#wishCover").value) $("#wishCover").value = meta.imageUrl;
      } catch (e) {
        alert("Failed to fetch metadata. Try again.");
      } finally {
        fetchWishMetaBtn.disabled = false; fetchWishMetaBtn.textContent = "Auto-fill with metadata";
      }
    });

    wishlistForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const device = $("#wishDevice").value.trim();
      const title = $("#wishTitle").value.trim();
      
      if (!device || !title) {
        alert("Please fill device and title.");
        return;
      }
      
      try {
        await addGame({
          device,
          title,
          releaseDate: $("#wishRelease").value || "",
          imageUrl: $("#wishCover").value || "",
          notes: $("#wishNotes").value.trim(),
          isWishlist: true,
          storagePath: "N/A"
        });
        render();
        wishlistForm.reset();
      } catch (error) {
        alert("Failed to add to wishlist. Check server connection.");
      }
    });

    // Event handlers
    libraryGrid.addEventListener("click", async (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;
      const id = btn.dataset.id;
      const action = btn.dataset.action;

      if (action === "delete") {
        if (!confirm("Delete this game?")) return;
        try {
          await deleteGame(id, false);
          render();
        } catch (error) {
          alert("Failed to delete game.");
        }
      } else if (action === "fetch-review") {
        const g = state.find(x => x._id === id);
        if (!g) return;
        
        btn.disabled = true;
        btn.textContent = "Loading...";
        
        try {
          const review = await fetchIGDBReviews(g.title);
          await updateGame(id, { review });
          render();
        } catch (error) {
          alert("Failed to fetch review.");
          btn.disabled = false;
          btn.textContent = "Get Review";
        }
      } else if (action === "save-storage") {
        const input = libraryGrid.querySelector(`input.storage-edit[data-id="${id}"]`);
        try {
          await updateGame(id, { storagePath: input.value.trim() });
          btn.textContent = "Saved ‚úì";
          setTimeout(() => btn.textContent = "Save", 800);
        } catch (error) {
          alert("Failed to save storage path.");
        }
      }
    });

    wishlistGrid.addEventListener("click", async (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;
      const id = btn.dataset.id;
      const action = btn.dataset.action;

      if (action === "delete-wish") {
        if (!confirm("Remove from wishlist?")) return;
        try {
          await deleteGame(id, true);
          render();
        } catch (error) {
          alert("Failed to delete game.");
        }
      } else if (action === "move-to-library") {
        if (!confirm("Move this game to your library?")) return;
        await moveToLibrary(id);
      }
    });

    filterRadios.forEach(r => r.addEventListener("change", render));
    searchInput.addEventListener("input", render);

    $("#exportBtn").addEventListener("click", () => {
      const json = JSON.stringify([...state, ...wishlist], null, 2);
      const blob = new Blob([json], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `game-tracker-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
    });

    $("#importBtn").addEventListener("click", () => {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "application/json";
      input.addEventListener("change", async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        try {
          const text = await file.text();
          const imported = JSON.parse(text);
          if (!Array.isArray(imported)) throw new Error("Invalid format");
          
          for (const game of imported) {
            await addGame(game);
          }
          alert(`Imported ${imported.length} games successfully!`);
          render();
        } catch (err) {
          alert("Failed to import file. Please check the format.");
        }
      });
      input.click();
    });

    (async () => {
      updateConnectionStatus(false);
      await loadGames();
      render();
    })();
  </script>
</body>
</html>