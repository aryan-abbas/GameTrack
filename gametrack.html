<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f1220;
      --panel: #171a2a;
      --muted: #8b90a8;
      --text: #e6e8f3;
      --accent: #6a9efc;
      --danger: #ff5468;
      --success: #59d398;
      --border: #262a3f;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }
    header {
      padding: 16px 20px; border-bottom: 1px solid var(--border); background: var(--panel);
      display: flex; align-items: center; justify-content: space-between;
    }
    header h1 { margin: 0; font-size: 20px; }
    .container { display: grid; grid-template-columns: 260px 1fr; gap: 16px; padding: 16px; }
    .card {
      background: var(--panel); border: 1px solid var(--border); border-radius: 10px; overflow: hidden;
    }
    .card h2 { font-size: 16px; margin: 0; padding: 12px 14px; border-bottom: 1px solid var(--border); color: var(--muted); }
    .card .content { padding: 14px; }
    /* Filters */
    .filters label { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; cursor: pointer; }
    .filters input[type="radio"] { accent-color: var(--accent); }
    /* Form */
    form { display: grid; gap: 10px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    input, select, button {
      padding: 10px 12px; border: 1px solid var(--border); border-radius: 8px; background: #121528; color: var(--text);
    }
    input::placeholder { color: #70779c; }
    button { cursor: pointer; background: var(--accent); border: none; color: #0b1020; font-weight: 600; }
    button.secondary { background: #1d2240; color: var(--text); border: 1px solid var(--border); }
    button.danger { background: var(--danger); color: #fff; }
    /* Library */
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 12px; }
    .game {
      background: #121528; border: 1px solid var(--border); border-radius: 10px; overflow: hidden;
      display: grid; grid-template-rows: 140px auto; min-height: 260px;
    }
    .game .cover { background: #0b0e1c; display: flex; align-items: center; justify-content: center; }
    .game img { max-width: 100%; max-height: 100%; object-fit: cover; }
    .game .meta { padding: 12px; display: grid; gap: 6px; }
    .badge { display: inline-block; padding: 4px 8px; border-radius: 999px; font-size: 12px; background: #1d2240; border: 1px solid var(--border); color: var(--muted); }
    .muted { color: var(--muted); font-size: 12px; }
    .actions { display: flex; gap: 8px; margin-top: 8px; }
    .storage-row { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; }
    /* Footer note */
    .note { color: var(--muted); font-size: 12px; margin-top: 8px; }
    @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <header>
    <h1>Game Tracker</h1>
    <div>
      <button id="exportBtn" class="secondary">Export</button>
      <button id="importBtn" class="secondary">Import</button>
    </div>
  </header>

  <main class="container">
    <!-- Filters -->
    <section class="card">
      <h2>Filters</h2>
      <div class="content filters">
        <label><input type="radio" name="deviceFilter" value="ALL" checked /> All devices</label>
        <label><input type="radio" name="deviceFilter" value="PC" /> PC</label>
        <label><input type="radio" name="deviceFilter" value="Nintendo Switch" /> Nintendo Switch</label>
        <label><input type="radio" name="deviceFilter" value="PlayStation" /> PlayStation</label>
        <hr style="border-color: var(--border);" />
        <label class="storage">
          <input type="text" id="searchInput" placeholder="Search title…" />
        </label>
      </div>
    </section>

    <!-- Library + Add form -->
    <section class="card">
      <h2>Game library</h2>
      <div class="content">
        <form id="addForm" autocomplete="off">
          <div class="row">
            <h2>What platform is the game on?</h2>
            <select id="device" required>
              <option value="">Choose device</option>
              <option>PC</option>
              <option>Nintendo Switch</option>
              <option>PlayStation</option>
            </select>
            <input id="titleInput" type="text" placeholder="Search game title…" required />
          </div>
          <div class="row">
            <input id="storageInput" type="text" placeholder="Storage directory (e.g., D:\\Games\\Elden Ring)" required />
            <input id="releaseInput" type="date" placeholder="Release date (optional)" />
          </div>
          <div class="row">
            <input id="coverInput" type="url" placeholder="Cover art URL (optional)" />
            <button type="button" id="fetchMetaBtn" class="secondary">Fetch metadata</button>
          </div>
          <button type="submit">Add game</button>
          <p class="note">Tip: Click “Fetch metadata” to auto-fill from the mock API. You can replace it with RAWG/IGDB later.</p>
        </form>

        <div id="libraryGrid" class="grid" aria-live="polite"></div>
      </div>
    </section>
  </main>

  <script>
const API_URL = "http://localhost:3000/games"; // backend endpoint
let state = [];

const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => Array.from(document.querySelectorAll(sel));
const uid = () => Math.random().toString(36).slice(2, 10);

// Fetch helpers 
async function loadGames() {
  const resp = await fetch(API_URL);
  state = await resp.json();
  render();
}

async function addGame(game) {
  await fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(game)
  });
  loadGames();
}

async function updateGame(id, updates) {
  await fetch(`${API_URL}/${id}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(updates)
  });
  loadGames();
}

async function deleteGame(id) {
  await fetch(`${API_URL}/${id}`, { method: "DELETE" });
  loadGames();
}

// Render
const grid = $("#libraryGrid");
const filterRadios = $$("input[name='deviceFilter']");
const searchInput = $("#searchInput");

function render() {
  const deviceFilter = filterRadios.find(r => r.checked)?.value || "ALL";
  const term = searchInput.value.trim().toLowerCase();
  grid.innerHTML = "";

  const filtered = state.filter(g => {
    const matchDevice = deviceFilter === "ALL" || g.device === deviceFilter;
    const matchTerm = !term || g.title.toLowerCase().includes(term);
    return matchDevice && matchTerm;
  });

  if (filtered.length === 0) {
    grid.innerHTML = `<div class="muted">No games found. Try adding one above.</div>`;
    return;
  }

  for (const g of filtered) {
    const card = document.createElement("div");
    card.className = "game";
    card.innerHTML = `
      <div class="cover">${g.imageUrl ? `<img src="${g.imageUrl}" alt="${escapeHtml(g.title)} cover" />` : `<span class="muted">No cover</span>`}</div>
      <div class="meta">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <strong>${escapeHtml(g.title)}</strong>
          <span class="badge">${g.device}</span>
        </div>
        <div class="muted">Release: ${g.releaseDate || "Unknown"}</div>
        <div class="storage-row">
          <input type="text" value="${escapeAttr(g.storagePath)}" data-id="${g.id}" class="storage-edit" />
          <button class="secondary" data-id="${g.id}" data-action="save-storage">Save</button>
        </div>
        <div class="actions">
          <button class="secondary" data-id="${g.id}" data-action="edit">Edit</button>
          <button class="danger" data-id="${g.id}" data-action="delete">Delete</button>
        </div>
      </div>
    `;
    grid.appendChild(card);
  }
}

function escapeHtml(s = "") {
  return s.replace(/[&<>"']/g, c => ({ "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;", "'":"&#39;" }[c]));
}
function escapeAttr(s = "") {
  return s.replace(/"/g, "&quot;");
}

// Library logic
const addForm = $("#addForm");
const deviceSel = $("#device");
const titleInput = $("#titleInput");
const storageInput = $("#storageInput");
const releaseInput = $("#releaseInput");
const coverInput = $("#coverInput");
const fetchMetaBtn = $("#fetchMetaBtn");

fetchMetaBtn.addEventListener("click", async () => {
  const q = titleInput.value.trim();
  if (!q) { alert("Enter a game title first."); return; }
  fetchMetaBtn.disabled = true; fetchMetaBtn.textContent = "Fetching…";
  try {
    const meta = await fetchMetadata(q);
    if (!releaseInput.value) releaseInput.value = meta.releaseDate;
    if (!coverInput.value) coverInput.value = meta.imageUrl;
  } catch (e) {
    alert("Failed to fetch metadata. Try again.");
  } finally {
    fetchMetaBtn.disabled = false; fetchMetaBtn.textContent = "Fetch metadata";
  }
});

addForm.addEventListener("submit", (e) => {
  e.preventDefault();
  const device = deviceSel.value.trim();
  const title = titleInput.value.trim();
  const storagePath = storageInput.value.trim();
  if (!device || !title || !storagePath) {
    alert("Please fill device, title, and storage directory.");
    return;
  }
  const game = {
    id: uid(),
    device,
    title,
    storagePath,
    releaseDate: releaseInput.value || "",
    imageUrl: coverInput.value || ""
  };
  addGame(game);
  addForm.reset();
});

// Library 
grid.addEventListener("click", (e) => {
  const btn = e.target.closest("button");
  if (!btn) return;
  const id = btn.dataset.id;
  const action = btn.dataset.action;

  if (action === "delete") {
    deleteGame(id);
  } else if (action === "edit") {
    const g = state.find(x => x.id === id);
    if (!g) return;
    deviceSel.value = g.device;
    titleInput.value = g.title;
    storageInput.value = g.storagePath;
    releaseInput.value = g.releaseDate || "";
    coverInput.value = g.imageUrl || "";

    const submitBtn = addForm.querySelector("button[type='submit']");
    const originalText = submitBtn.textContent;
    submitBtn.textContent = "Update game";
    const handler = (ev) => {
      ev.preventDefault();
      const updates = {
        device: deviceSel.value,
        title: titleInput.value.trim(),
        storagePath: storageInput.value.trim(),
        releaseDate: releaseInput.value || "",
        imageUrl: coverInput.value || ""
      };
      updateGame(id, updates);
      addForm.reset();
      submitBtn.textContent = originalText;
      submitBtn.removeEventListener("click", handler);
    };
    submitBtn.addEventListener("click", handler);
  } else if (action === "save-storage") {
    const input = grid.querySelector(`input.storage-edit[data-id="${id}"]`);
    if (input) {
      updateGame(id, { storagePath: input.value.trim() });
      btn.textContent = "Saved ✓";
      setTimeout(() => btn.textContent = "Save", 800);
    }
  }
});

filterRadios.forEach(r => r.addEventListener("change", render));
searchInput.addEventListener("input", render);

// --- Init ---
loadGames();
</script>

</body>
</html>
  